---
layout: post
title: Time use and fertility rates
date: 2025-08-03
tag: 
   - ModellingStrategy
   - DataFromTheWeb
description: A cross-country panel regression of fertility rate on the gender split of time spent on care and domestic chores. With musings on causality, DAGs, modelling strategy, and sourcing data.
image: /img/0290-dg.svg
socialimage: https:/freerangestats.info/img/0290-dg.png
category: R
---

## Summary

If you look at just a selection of rich countries, you might see a positive correlation between men's share of unpaid domestic work and the number of children being born; but if you look at all countries with data available there is clearly a strong negative relationship. In the larger dataset, this domestic work variable is standing in as a proxy for general economic opportunities for women and for economic development in general, in fact for the so-called 'demographic transition'. If we think carefully&mdash;and use diagrams to help&mdash;about what is impacting on fertility rates and how, we can construct a much more plausible and subtle model.

Once we control for economic development and for gender inequality, any impact of "male share of unpaid domestic work" on fertility mostly disappears. Reasonable modelling choices about interactions of a GDP effect with the housework effect, or the non-linearity of the main confounding effects, can lead to different findings of statistical significance of the domestic work variable, but whatever it is it certainly isn't large.

To meaningully answer the question "does men doing more housework lead to women deciding to have more children", we really need more household and individual level data, not cross-country regressions.

On the way in this extremely long blog post I explore a few interesting technical issues, any of which really could have been a blog post in their own right:
- how to draw directed graphs in `ggdag` with different colours for the edges connecting nodes
- how to access data from the UN SDG database' API
- prediction plots to communicate results from a model where our main variable of interest enters the model via an interaction effect, including both my home-made version and the powerful and incredibly useful `marginaleffects` package
- how to prepare data and build a statistical model where we have multiple observations for some entities but only one for many; and all the observations come from different times
- using `gamm` and `gam` from the `mgcv` package to model panel data with random effects and how these are different from `lmer` from the `lme4` package, including wondering about the use of a log transform of the response variable or leaving it as-is and having a log link function and quasipoisson family
- the wisdom or not of including a spline effect for time in such a model

<hr>

## Pre-data musings on time-use and number of children
Some months ago a post floated across my Bluesky feed making an argument to the effect of "if societies want more children, then men should do more of the housework", accompanied by a chart from a few-years-old paper.  The chart was a scatter plot with something like male share of unpaid domestic chores on the horizontal axis and total fertility rate on the vertical axis&mdash;each point was one of selected OECD countries at a point in time for which data on both variables was available&mdash;and there was a definite positive correlation. 

The case was being made that if you think the world isn't having enough children (not something I personally subscribe to but let's accept it as a problem for some people), the answer might be more feminism and gender equality, not less. And the obvious context being the various pro-traditionalism, trad-wife, etc arguments to the opposite effect, going around in the altogether rather contemptible (again, obviously just my own view) pro-natalism discourse.

> Might as well get on the record, while it's not relevant statistically, that I'm fully for more feminism and gender equality, and I also think "and then women will have more children" is a bad argument for it.

Unfortunately both the Bluesky post I saw and the original article have now escaped me, but I do remember that the data was a bit old (2010s), and some people commenting 'ah, woke Scandinavian country X where men do lots of housework, but since the time in this chart *they* have stopped having as many children too'. More importantly, I was intrigued by the use of "selected countries" in the title. Selected how and why, I wondered at the time. 

Obviously, limiting the analysis to rich countries gives a narrow view on a bigger relationship. Because one of the strongest empirical relationships in demography, on a historical scale, is the observation that as women and girls get more educational and economic opportunities they tend to have less children, in terms of a society-wide average of a country going through economic development. 

> I'm old enough to remember when everyone I engaged with seemed to agree this was a good thing, both in terms of the extra opportunities and choices for women as a good in itself, and avoiding cramming too many people into an already crowded and under-resourced planet. Apparently this is no longer a consensus, which just leaves me, I don't know, stroking my grey beard and feeling the world's passed me by.

I would expect, world-wide, that women do a higher share of the housework in countries where they have less economic opportunities (would you call these more patriarchal and 'traditional' societies? somewhat difficult to get a non-offensive terminology here).  In fact, what I'd expect is a diagram of causes and effects that looks something like this:

<object type="image/svg+xml" data='/img/0290-dg.svg' width='100%'><img src='/img/0290-dg.png' width='100%'></object>

In this model, economic and education opportunities for women and girls leads to choices to have less children and a decrease in total fertility rate, shown with a red arrow because of the downwards impact. Men doing more housework as a result of a rising culture of gender equality and changing social norms has an impact (probably smaller) in the opposite direction, with a blue arrow. That culture of gender equality itself comes about partly from changing economic conditions (women moving in to visible roles) and partly advocacy. Naturally, this is a gross over-simplification of the reality of these processes.

This isn't a directed acyclic graph (DAG) because it's not acyclic - some of the arrows are two-way, such as economic growth leading to more economic and educational opportunities for women and girls, and economic and educational opportunities for women  and girls leading to economic growth. But you could reduce it to a DAG if you limited it to the three key variables of total fertility rate, men doing housework, and opportunities for women and girls.

<object type="image/svg+xml" data='/img/0290-dg-simplified.svg' width='100%'><img src='/img/0290-dg-simplified.png' width='100%'></object>

This simplified version doesn't make it clear where increased opportunities for women and girls come from or why they lead to men doing more of the housework; the original diagram shows that this was expected to happen via the (difficult to observe and complex to evolve) mediating factor of a general culture of gender equality. 

The simplified diagram helps us think through what would happen if we ignore the confounder of "economic and educational opportunities for women and girls" and just plot male share of unpaid domestic chores against total fertility rate. 

* On a simple two-variable scatter plot, we'd expect a negative correlation, because the time use variable is actually standing in as a proxy for the more important gender equality of opportunities. 
* But if you could get a better indicator of that confounding opportunities variable and control for it, and if there really is an impact from male share of housework on higher fertility decisions, you *might* get a positive effect of male share of domestic work on fertility.

The code for drawing those graphs, and in general setting up the session for subsequent confronting these more theoretical musings with data is below. There's one clever trick to colour-code the edges, I haven't seen this documented elsewhere, you need to use the hidden `ggdag::tidy_daggity` function explicitly and add a colour column (with the actual colours you want to use as character strings) before sending it to ggplot:

*Blog post continues below each chunk of R code:*
{% highlight R lineanchors %}
library(tidyverse)
library(httr)
remotes::install_github("hrbrmstr/curlconverter")
library(curlconverter)
library(janitor)
library(countrycode)
library(rsdmx)   # for reading the World Economic Outlook data
library(WDI)     # for gettting literacy data from the World Development Indicators
library(readxl)
library(glue)
library(ggrepel)
library(mgcv)   # for gam
library(ggdag)
library(MASS)   # for rlm
library(RColorBrewer)
library(GGally)
library(lme4)
library(patchwork)
library(marginaleffects)

conflicts_prefer(dplyr::lag)
conflicts_prefer(dplyr::select)


#-----------drawing a DAG (or at least a DG)------------------

# Full version with all the variables
dg <- dagify(tfr ~ opp + hw ,
             ge ~ opp + advoc, 
             opp ~ ge + advoc,
             hw ~ ge,
             opp ~ gdp,
             gdp ~ opp,
             
             labels = c(
               "tfr" = "Total fertility rate",
               "hw" = "Men doing housework",
               "opp" = "Opportunities for\nwomen and girls",
               "ge" = "Culture of\ngender equality",
               "gdp" = "Economic growth",
               "advoc" = "Feminist advocacy"
             ),
             outcome = "tfr",
             latent = "ge",
             exposure = "hw"
) |> 
  # explicitly call this usually hidden function so we can colour the edges:
  ggdag::tidy_dagitty(seed = 124) |> 
  # colour the edges. Need to specify identity of colour here, not use scale_
  mutate(edge_type = ifelse(to == "tfr" & name == "opp", "darkred", "steelblue"))

lab_col <- "black"

# Draw the full chart
set.seed(124)
dg |> 
  ggplot(aes(x = x, y = y, xend = xend, yend =yend)) +
  geom_dag_node(colour = "grey") +
  geom_dag_text_repel(aes(label = label), col = lab_col) +
  geom_dag_edges(aes(edge_colour = edge_type),
                 arrow_directed = grid::arrow(length = unit(12, "pt"), type = "closed")) +
  theme_dag(base_family = "Roboto")

# Simplified DAG, just with 3 nodes
dg2 <- dagify(tfr ~ opp + hw ,
             hw ~ opp,

             labels = c(
               "tfr" = "Total fertility rate",
               "hw" = "Men doing housework",
               "opp" = "Opportunities for\nwomen and girls"
             ),
             outcome = "tfr",
             exposure = "hw"
)  |> 
  # explicitly call this usually hidden function so we can colour the edges:
  ggdag::tidy_dagitty(seed = 124) |> 
  # colour the edges. Need to specify identity of colour here, not use scale_
  mutate(edge_type = ifelse(to == "tfr" & name == "opp", "darkred", "steelblue"))

# Draw the simplified causal graph
set.seed(125)
dg2 |> 
  ggplot(aes(x = x, y = y, xend = xend, yend =yend)) +
  geom_dag_node(colour = "grey") +
  geom_dag_edges(aes(edge_colour = edge_type), 
                 arrow_directed = grid::arrow(length = unit(12, "pt"), type = "closed")) +
  geom_dag_text_repel(aes(label = label), col = lab_col) +
  theme_dag(base_family = "Roboto")
{% endhighlight %}


## ... All others must bring data

### First look
OK then let's look at some data. Sustainable Development Goals (SDG) Indicator 5.4.1 is ["the Proportion of time spent on unpaid domestic chores and care work, by sex, age and location (%)"](https://metadata.un.org/sdg/SL_DOM_TSPD?lang=en), which is fantastic because it means we have an internationally agreed standard on how this is measured, and what data is available will be in the United Nations Statistical Division's definitive database of the SDG indicators. Data won't be available for all countries, and certainly not for all years in all countries, because it depends on a difficult and expensive time use survey. Very few countries can afford to prioritise one of these regularly and frequently, and many have never had one at all.

For the vertical axis of our first plot, we can get total fertility rate from various sources, but one convenient one that gives an estimate for each country for each year on a standardised, comparable basis is the UN's World Population Prospects.

We have several challenges in using this data:
* The official SDG indicators don't actually include an obvious single dimensional summary of gender share of housework, so we will need to construct it with something like `male_share = male / (male + female)`. Where `male` is the proportion of men's time spent on dometic chres and carework, `female` the equivalent for women. We can make a composite indicator like this because the denominator (total time in the day) for both `male` and `female` is the same.
* Some countries have multiple observations (more than one year with a time use survey) and we'd like to incorporate them somehow. This implies some kind of multilevel model with a country-level random effect as well as residual randomness at the country-year level. On a chart, we can show these multiple observations by connecting points with segments, and visually differentiating the most recent observation from those in earlier surveys. This is much better than just picking one survey per country.
* The years of time use surveys vary significantly over a 20+ year time period, so we should expect a possible time effect to complicate any inference we do. We need to take this into account both in our statistical modelling and our visualisations.
* Not all the age groups are equivalent across countries, so we will have to grit our teeth for some inconsistent definitions of women and men (i.e. when does adulthood start).

My first intent is to get this chart that tries to at least represent the full range of these issues and imply a modelling strategy that would take them into account:
<object type="image/svg+xml" data='/img/0290-simple-scatter.svg' width='100%'><img src='/img/0290-simple-scatter.png' width='100%'></object>

As expected, there's a strongish negative relationship here, consistent with my thinking about economic and educational opportunities for women and girls being an important confounding variable. 

What about if we introduce some other variables, proxies for the economic opportunities for women and girls? Obvious candidates are income or, failing that,  GDP per capita, appropriately controlled for purchasing power parity in each country and point of time; and some general female empowerment index like relative literacy (say female literacy divided by male literacy, at age 15). 

What I'm after here is drawing some charts like this which will get us started in seeing if the apparent relationship between male share of domestic chores and fertility rate is really an artefact of confounding variables like overall economic development. 

<object type="image/svg+xml" data='/img/0290-facet-scatter.svg' width='100%'><img src='/img/0290-facet-scatter.png' width='100%'></object>

Here we do see, for example, a very interesting result that within the three lower income categories of countries there is a negative relationship between male share of domestic chores and fertility, but in the highest income category that relationship is reversed. In fact, the (lost) scatter plot that started me on this whole journey was basically the bottom right facet of this diagram.

We need to do more though - we can get a better measure of female economic empowerment (and hence choices between motherhood and employment), and we're definitely going to want a statistical model to tease all these effects out. More on that later.

### Data sources
To access the SDG data on **time spent on domestic chores** and make my "male share" index, I can go straight to the definitive UN SDGs database.  I don't know of an R package to simplify access to it so had to hit the API directly, with some old-fashioned and clunky but working `httr` code. 

The Population Prospects which includes **total fertility rate** estimated for every year and country from 1950 to 2050 is easy enough to download as a single big CSV and I've done this in previous blog posts. 

Unfortunately direct data on literacy or other education outcomes is not good enough to easily get a value for each year in each country. But there are a variety of modelled indexes available that try to cater for this and we can re-use them rather than reinventing the wheel. I opted for the **[Gender Inequality Index](https://hdr.undp.org/data-center/thematic-composite-indices/gender-inequality-index#/indicies/GII)** the UNDP uses as part of its suite of data related to the Human Development Report. This takes into account reproductive health, economic empowerment and gender outcomes in the labour market. Higher values mean more inequality. Numbers must have been modelled and imputed to high heaven, but experts have done this for us and as a result we have a number for nearly all countries for each year between 1990 and 2023.

The indicators used in the Gender Inequality Index are:
* Maternal mortality ratio
* Adolescent birth rate
* Female and male population with at least secondary eductaion
* Female and male shares of parliamentary seats
* Female and male labour force participation rates

**GDP per capita on purchasing power parity basis** I sourced from the most recent IMF World economic Outlook, which [I blogged about](/blog/2025/04/26/imf-weo-updates) shortly after it came out and was conveniently available for me. Like the GII, this comes with numbers that are consistent across countries and time and that are remarkably complete.

Let's pause and look at these variables one at a time, labelled by individual countries to make it more real for ourselves. To reduce clutter I'm considering only those countries that also have at least one time use survey (and hence the male share of domestic chores indicator), and in two of the charts below showing only one observation for each country.

First time share itself. I'm only showing the latest observation for each country here, but we still see that this varies from 2000 to 2023. And remember that 100 or so countries have no observation at all.

<object type="image/svg+xml" data='/img/0290-time-share-bar.svg' width='100%'><img src='/img/0290-time-share-bar.png' width='100%'></object>

Next the total fertility rate, from the UN Population Prospects. I've picked 2025, the current year at time of writing, to show here. Of our countries, China and South Korea stand out with their very low number of births per woman, and African countries at the other end of the scale.

<object type="image/svg+xml" data='/img/0290-tfr-lollipop.svg' width='100%'><img src='/img/0290-tfr-lollipop.png' width='100%'></object>

Finally, the Gender Inequality Index. Higher values mean more gender inequality. A surprise for me is seeing USA near the top in the high income bracket; without going into the composition (something for another time?) I'm guessing this might be related to maternal mortality and adolescent motherhood.

<object type="image/svg+xml" data='/img/0290-gii-lollipop.svg' width='100%'><img src='/img/0290-gii-lollipop.png' width='100%'></object>

Downloading this data and combining it in a way that preserves the multiple observations per country needs a little care and is done in the longish chunk of R code below, which also draws the very first simple scatter plot used in this blog.

{% highlight R lineanchors %}
#-----------downloading some SDG time use data from the UN database-------------
# Note sure this is the best way to do this, it was clunky to work out,
# but it works. Someone should (or have they already?) build an R package.
#
# this is all httr, I understand httr2 is the  current thing now, but this still works 
request <- "curl -X POST --header 'Content-Type: application/x-www-form-urlencoded' --header 'Accept: application/octet-stream' -d 'seriesCodes=SL_DOM_TSPD' 'https://unstats.un.org/sdgapi/v1/sdg/Series/DataCSV'" |> 
  straighten() |> 
  make_req()

gender_txt <- content(request[[1]](), as = "text")


gender <- read_csv(gender_txt) |> 
  clean_names()

count(gender, sex)      # two categories, FEMALE and MALE - no TOTAL
count(gender, age)      # many different ages used for different countries
count(gender, location) # there's ALLAREA, RURAL and URBAN

# should be only one indicator:
stopifnot(length(unique(gender$series_description)) == 1)
# which is 
# Proportion of time spent on unpaid domestic chores and care work, by sex, age and location (%) 

time_chores <- gender |> 
  # we don't want rural and urban, just country total:
  filter(location == "ALLAREA") |> 
  # we want the ages like 15+, 12+ etc, not those like 15-59 with an upper bound
  filter(grepl("^[0-9]*\\+$", age)) |> 
  # but not the retirees, which some countries include. We want the 15+, not 15+
  # and 65+ separately:
  filter(!age %in% c("65+", "85+", "60+")) |> 
  # calculate the male time spent as a proportion of total (male and female) time spent
  group_by(geo_area_name, time_period, age) |> 
  summarise(prop_male = value[sex == 'MALE'] / sum(value[sex == 'MALE'] + value[sex == 'FEMALE'])) |> 
  group_by(geo_area_name) |> 
  # Label the latest survey per country. Note that any modelling needs to
  # include a country random effect for the multiple observations per country:
  mutate(is_latest = ifelse(time_period == max(time_period), "Most recent", "Earlier")) |> 
  # limit to just the best age group, closest to adults, for each country/time:
  group_by(geo_area_name, time_period) |> 
  mutate(age = factor(age, levels = c("15+", "16+", "18+", "12+", "10+", "6+", "5+", "3+"))) |> 
  arrange(geo_area_name, time_period, age) |> 
  slice(1) |> 
  ungroup() |> 
  mutate(iso3_code = countrycode(geo_area_name, origin = "country.name.en", destination = "iso3c"))


#--------combine time use with fertility data --------------------------

# total fertility rate, from the UN Population Projections
if(!file.exists("wpp2024.csv")){
  download.file("https://population.un.org/wpp/assets/Excel%20Files/1_Indicator%20(Standard)/CSV_FILES/WPP2024_Demographic_Indicators_Medium.csv.gz",
                destfile = "wpp2024.csv", mode = "wb")
}

wpp <- read_csv("wpp2024.csv") |> 
  clean_names() |> 
  select(iso3_code, time_period = time, tfr) |> 
  filter(!is.na(iso3_code))
 
#-----------------add income and divide countries into groups-----------------
# first simple scatter plot
time_chores |>
  left_join(wpp, by = c("iso3_code", "time_period")) |> 
  ggplot(aes(x = prop_male, y = tfr)) +
  geom_smooth(method = "lm", colour = "white") +
  geom_point(aes(shape = is_latest, colour = time_period), size = 2) +
  geom_path(aes(group = geo_area_name), colour = "grey75") +
  scale_shape_manual(values = c(1, 19)) +
  scale_x_continuous(label = percent) +
  scale_y_continuous() +
  guides(colour =  guide_colorbar(display = "rectangles")) +
  theme(legend.key.width = unit(10, "mm")) +
  labs(x = "Proportion of unpaid domestic and care work done by males",
       y ="Total fertility rate",
       colour = "Observation date:",
       shape = "Observation type:",
       title = "Gender share of unpaid domestic work and fertility rate",
       subtitle = "When including all countries, relationship between male share of domestic and care work and fertility is negative.
Confounding effect of economic and educational opportunities for women and girls has not been controlled for.",
       caption = "Time use data from the UN SDGs database; total fertility rate from the UN World Population Prospects. Analysis by freerangestats.info.")

# Income is almost certainly a confounder. We can use the IMF WEO data from last week
# (see that blog for how to access it, or run 0288-IMF-WEO.R script in this
# same repository)
if(!exists("d2025")){
  d2025 <- readSDMX("WEOAPR2025/xmlfile_APR2025.xml", isURL = FALSE) |> 
    # this parsing takes a long time:
    as_tibble()
}

ref_areas <-   read_xlsx("WEOAPR2025/WEOPUB_DSD_APR2025.xlsx", sheet = "REF_AREA", skip = 7)[, 1:2] |> 
  rename(REF_AREA = Code,
         country = Description)

gdp <- d2025 |> 
  filter(CONCEPT == "NGDPRPPPPC") |> 
  select(time_period = TIME_PERIOD,
         gdprppppc = OBS_VALUE,
         REF_AREA) |> 
  mutate(gdprppppc = as.numeric(gdprppppc),
         time_period = as.numeric(time_period)) |> 
  filter(!is.na(gdprppppc)) |> 
  left_join(ref_areas, by = "REF_AREA") |> 
  mutate(iso3_code = countrycode(country, origin = "country.name.en", destination = "iso3c")) |> 
  filter(!is.na(iso3_code)) |> 
  select(-REF_AREA)

time_fert_gdp <- time_chores |> 
  select(-geo_area_name) |> 
  full_join(wpp, by = c("iso3_code", "time_period")) |> 
  full_join(gdp, by = c("iso3_code", "time_period")) |> 
  # missing data for GDP for Cuba and Reunion
  # filter(!is.na(gdprppppc)) |>
  complete(iso3_code, time_period, fill = list(gdprpppc = NA)) |> 
  # classify countries into four income categories based on income in 2000:
  group_by(iso3_code) |> 
  mutate(latest_gdp = gdprppppc[time_period == max(time_period)],
         gdp_2000 = unique(gdprppppc[time_period == 2000]),
         gdp_min = min(gdprppppc, na.rm = TRUE),
         gdp_for_cut = ifelse(is.na(gdp_2000), gdp_min, gdp_2000)) |> 
  ungroup() |> 
  mutate(gdp_cut = cut(gdp_for_cut, breaks = quantile(unique(gdp_for_cut), na.rm = TRUE),
                       include.lowest = TRUE,
                       labels = c("Lowest income", "Low income", 
                                  "Medium income", "High income")))

#-------------female empowerment?----------------------
# higher income is only the most obvious confounder. There's also the general
# sense of female economic opportunities and empowerment. A fair proxy of this
# is probably female literacy as a proportion of male literacy

# these didn't have enough data for each year
# WDIsearch("litera") |> View()
# Literacy rate, youth (ages 15-24), gender parity index (GPI)
# Literacy rate, youth female (% of females ages 15-24)

# this gender inequality index (GII), composite index from UNDP taking into
# account info on reproducive health, empowerment and the labour market. see
# https://hdr.undp.org/data-center/thematic-composite-indices/gender-inequality-index#/indicies/GII

# You can download all the HDR components (including GII):
download.file("https://hdr.undp.org/sites/default/files/2025_HDR/HDR25_Composite_indices_complete_time_series.csv",
              destfile = "hdr25.csv")

hdr <- read_csv("hdr25.csv")

gii <- hdr |> 
  select(iso3_code = iso3, contains("gii")) |> 
  select(-contains("rank")) |> 
  gather(variable, gii, -iso3_code) |> 
  drop_na() |> 
  separate(variable, sep = "_", into = c("variable", "time_period")) |> 
  select(-variable) |> 
  mutate(time_period = as.numeric(time_period))

combined <- time_fert_gdp |> 
  left_join(gii, by = c("iso3_code", "time_period"))  |> 
  # factor version of country, needed for some later modelling:
  mutate(country_fac = fct_reorder(country, -gdp_for_cut))

# 193 countries:
length(unique(combined$country))

# Only 79 have all the data we need
combined |> 
  filter(!is.na(gii) & !is.na(gdprppppc) & !is.na(prop_male)) |> 
  distinct(country) |> 
  nrow()

# Used this to work out Oman is missing GII data in 2000 but it is ok in 2008
# so only loses one row
filter(combined, country == "Oman" &!is.na(prop_male)) |> t()

# Only 5 rows of data lost altogether from GII:
combined |> 
  filter(!is.na(gdprppppc) & !is.na(prop_male)) |> 
  filter(is.na(gii)) |> 
  nrow()

# and only one (Cuba) from having no gdp per capita in a year we otherwise
# could include it:
combined |> 
  filter(!is.na(prop_male) & !is.na(gii)) |> 
  filter(is.na(gdprppppc)) |> 
  nrow()

# 172 observations altogether (so will go down to 172 in modelling)
combined |> 
  filter(!is.na(gii) & !is.na(gdprppppc) & !is.na(prop_male)) |> 
  nrow()
{% endhighlight %}

The bar and lollipop charts of time use, fertility and gender inequality; and the faceted scatter plot of fertility v time use that have been used in the text above are all drawn in the code here:

{% highlight R lineanchors %}
#================Exploratory charts==============

# countries that have at least one observation of all four variables:
countries_ok_data <- combined |> 
  filter(!is.na(gii) & !is.na(tfr) & !is.na(gdprppppc) & !is.na(prop_male)) |> 
  distinct(country)

#-----------------some unidimensional ones---------
#
combined |> 
  inner_join(countries_ok_data, by = "country") |> 
  filter(!is.na(prop_male)) |> 
  group_by(country_fac) |> 
  arrange(desc(time_period)) |> 
  slice(1) |> 
  ungroup() |> 
  mutate(country_fac = fct_reorder(country_fac, -prop_male, .fun = max)) |> 
  ggplot(aes(y = country_fac, x = prop_male, fill = as.ordered(time_period))) +
  geom_col(position = "dodge", width = 0.7) +
  theme(panel.grid.major.y = element_blank()) +
  facet_wrap(~gdp_cut, ncol = 2, scales = "free_y") +
  scale_x_continuous(label = percent, expand = c(0, 0)) +
  guides(fill = guide_legend(ncol = 15)) +
  labs(x = "Male share of domestic and care work as a proportion of total - most recent survey result",
       y = "",
       fill = "Year",
       title = "Male time on domestic and care work",
       subtitle = "Countries' income categorised by purchasing power parity GDP per capita in 2000. Ordering within facet is by male time on domestic work.",
       caption = "Source: UN Sustainable Development Goals database for time use; IMF World Economic Outlook for PPP GDP per capita")

# A couple of things we'll use a few times in the next few lollipops
st <- "Selected countries where time use, GDP and gender inequality data are all available"
lol_col <- "steelblue"

# Fertility rate
combined |> 
  inner_join(countries_ok_data, by = "country") |> 
  filter(time_period == 2025) |> 
  mutate(country_fac = fct_reorder(country_fac, tfr)) |> 
  ggplot(aes(y = country_fac, x = tfr)) +
  geom_segment(aes(xend =0, yend = country_fac), col = lol_col) +
  geom_point(col = lol_col) +
  theme(panel.grid.major.y = element_blank()) +
  scale_x_continuous(expand = c(0,0)) +
  facet_wrap(~gdp_cut, ncol = 2, scales = "free_y") +
  labs(x = "Total fertility rate (average number of children for a woman experiencing current age-specific fertility rates through a hypothetical lifetime)",
       y = "",
       fill = "Year",
       title = "Total fertility rate in 2025",
       subtitle = st,
       caption = "Source: UN Population Prospects for total fertility rate; IMF World Economic Outlookfor PPP GDP per capita")

# Gender inequality
combined |> 
  inner_join(countries_ok_data, by = "country") |> 
  filter(time_period == 2023) |> 
  mutate(country_fac = fct_reorder(country_fac, gii)) |> 
  ggplot(aes(y = country_fac, x = gii)) +
  geom_segment(aes(xend =0, yend = country_fac), col = lol_col) +
  geom_point(col = lol_col) +
  theme(panel.grid.major.y = element_blank()) +
  facet_wrap(~gdp_cut, ncol = 2, scales = "free_y") +
  scale_x_continuous(label = comma, expand = c(0,0)) +
  labs(x = "Gender Inequality Index",
       y = "",
       fill = "Year",
       title = "Gender Inequality Index",
       subtitle = st,
       caption = "Source: UNDP for Gender Inequality Index; IMF World Economic Outlookfor PPP GDP per capita")

## Faceted scatter plot showing income, domestic work and fertility together:

# some interesting countries to highlight
hlc <- c("Malawi", "Kyrgyzstan", "China", "Egypt", 
         "Brazil", "Oman", "Qatar", "Canada",
         "Korea", "Lao P.D.R.", "Pakistan", "Estonia")

combined |> 
  inner_join(countries_ok_data, by = "country") |> 
  filter(!is.na(time_period) & !is.na(prop_male)) |> 
  ggplot(aes(x = prop_male, y = tfr)) +
  facet_wrap(~gdp_cut, scales = "fixed") +
  geom_smooth(method = "rlm", colour = "white") +
  geom_point(aes(shape = is_latest, colour = time_period), size = 2) +
  geom_path(aes(group = country), colour = "grey50") +
  geom_text_repel(data = filter(combined, country %in% hlc & is_latest == "Most recent"),
                  aes(label = glue("{country}, {time_period}")), colour = "black",
                  seed = 123, size = 2.8) +
  #  uncomment next line to see every point labelled, useful for deciding which are 'interesting':
  #  geom_text(aes(label = country)) +
  scale_shape_manual(values = c(1, 19)) +
  scale_x_continuous(label = percent) +
  scale_y_log10() +
  guides(colour =  guide_colorbar(display = "rectangles")) +
  theme(legend.key.width = unit(10, "mm")) +
  labs(x = "Proportion of adult domestic and care work done by men",
       y ="Total fertility rate",
       colour = "Observation date:",
       shape = "Observation type:",
       title = "Share of domestic work and fertility rate, for countries in different income categories",
       subtitle = "Countries classified into custom groups based on purchasing power parity GDP in 2000. Selected countries labelled.",
       caption = "Time use data from the UN SDGs database; total fertility rate from the UN World Population Prospects; GDP from the IMF World Economic Outlook. Analysis by freerangestats.info.")

{% endhighlight %}

## Statistical modelling

### Challenges
Right, now I'm ready for a statistical model to try to disentangle these effects, and here I have to say I got into quite a muddle. One thing I was certain of was that I needed a mixed effects model with a random effect for country - when we have repeated observations (because multiple time use surveys) for some countries we want to use that information, but not treat each observation as independent and equally valuable. There are multiple ways to do this in R. 

I wanted to also take into account the possibility of some kind of complex interaction between income and male share of unpaid domestic work - as the faceted scatter plot earlier shows, perhaps more male housework means less children in poor countries when this is a proxy for female empowerment, but in wealthier countries the effect reverses. Or perhaps this is just the confounding effect in action.

I also was fretting about the different time at which the observations were happening - is there a global trend in this whole thing (I think probably yes) that we need to let soak up some of the variance which otherwise might be falsely attributed to systematic variation in when the time use surveys happened. And I had the usual concerns with what if any transformations of continuous variables to use, and if I should allow flexible non-linear splines.

On top of all this, we don't have any where near as much data as I'd like - only about 180 observations in total, for about 80 countries. Many of the countries have only a single observation, which is certainly going to make it harder to estimate different levels of random effects (for those countries, the country-level randomness cannot be distinguished from country-time randomness).

To start with, here is a straightforward pairs plot of the main variables, most of them having been log-transformed:

<object type="image/svg+xml" data='/img/0290-pairs.svg' width='100%'><img src='/img/0290-pairs.png' width='100%'></object>

It's pretty clear that GDP per capita is strongly negatively related to fertility rate (richer countries have less children, r=-0.7), gender inequality is strongly positively related (more gender-unequal countries have more children, r=0.8) and male share of unpaid domestic has a weaker negative relationship (r=-0.3). And the candidate explanatory variables are also correlated with eachother - richer countries have less gender inequality, and higher male proportion of unpaid domestic work.

### `lme4::lmer` - linear mixed effects model

The first thing I did was make a sort of null hypothesis model for myself, where logarithm of total fertility rate depends on GDP per capita and on gender inequality, there is a country level random effect; but no effect of male share of domestic chores. I did some quick graphic checks of that there weren't wild leverage points or violations of normality assumptions, and also plotted the residuals of this null model against the male domestic work variable (panel D. of the below) to get a sense check of the value add of a more complex model:

<object type="image/svg+xml" data='/img/0290-diagnose-0.svg' width='100%'><img src='/img/0290-diagnose-0.png' width='100%'></object>

What we see is that, straight out of the box, there's no visually obvious effect left for male share of domestic work. Panel D looks like white noise, with perhaps a bit of an upwards squiggle at the higher values. So, as we might have anticipated from both the pre-data musings and the pairs plot, the two obvious variables (gender inequality and GDP per capita) are doing the lion's work in explaining variance here.

Here's the code for fitting that first model and the diagnostic plots. I'm using `lmer` here with a log transform of total fertility rate as the response variable. My first instinct was to use a generalized linear model with a quasi-poisson response (log link function and variance is proportional to mean, but not identical to it), but `glmer` doesn't support quasi families so I fell back on the transform.

{% highlight R lineanchors %}
# Data set that we will use in the modelling:
model_ready <- combined |> 
  mutate(lgdp = log(gdprppppc),
         ltfr = log(tfr)) |> 
  select( prop_male, lgdp, ltfr, gii, gdprppppc, country_fac, tfr, time_period) |> 
  drop_na() 

# Pairs plot
model_ready |> 
  select(prop_male, lgdp, ltfr, gii) |> 
  ggpairs() |> 
    print()

#-------------modelling--------------------
# A basic null model:
model0 <- lmer(ltfr ~ gii + log(gdprppppc)  + (1 | country_fac), 
                data = model_ready)

post_fit <- model_ready |> 
  mutate(res0 = residuals(model0, type = "pearson"),
         fit0 = exp(fitted(model0))) |> 
  mutate(res0st = res0 / sd(res0))

refsd <- 0.745

# Combined diagram of 4 plots to diagnose model0 and look at possibilities
# for needing model1 or model2
post_fit |> 
  ggplot(aes(x = res0st)) +
  geom_density() +
  geom_rug() +
  stat_function(fun = dnorm, args = list(mean = 0, sd = refsd), 
                colour = "red") +
  stat_function(fun = dnorm, args = list(mean = 0, sd = 1), 
                colour = "darkblue") +
  labs(x = "Standardised residual",
       y = "Density",
       subtitle = "A.") +

post_fit |> 
  ggplot(aes(sample = res0st)) +
  stat_qq() +
  geom_abline(slope = 1, intercept = 0, colour = "darkblue") +
  geom_abline(slope = refsd, intercept = 0, colour = "red") +
  labs(x = "Residual expected if normally distributed",
       y = "Actual residual",
       subtitle = "B.") +
  
  
post_fit |>
  ggplot(aes(x = fit0, y = res0st)) +
  geom_hline(yintercept = 0, colour = "red") +
  geom_point() +
  geom_smooth(colour = "white") +
  scale_x_log10() +
  labs(x = "Fitted value of total fertility rate",
       y = "Standardised residual",
       subtitle = "C.") +
  
post_fit |> 
  ggplot(aes(x = prop_male, y = res0, colour = gdprppppc)) +
  geom_point(size = 2) +
  geom_smooth(method = "loess", colour = "white") +
  scale_color_viridis_c(label = dollar_format(accuracy = 1), trans = log_trans(),
                        breaks = c(3, 8, 22, 60) * 1000) +
  scale_x_continuous(label = percent) +
  theme(legend.position = "right") +
  labs(subtitle = "D. This plot identifies any residual fertility rate to be explained by housework",
       colour = "PPP GDP
per capita",
       x = "Proportion of housework done by males",
       y = "Total fertility rate (on log scale) 
*not* explained by GDP model") +
  
  theme(plot.margin = unit(c(1, 1, 1, 1), "cm")) +
  
  plot_layout(nrow = 2) +
  
  plot_annotation(title = "Diagnostic plots for model of log total fertility rate on countries' GDP per capita and Gender Inequality Index",
                  subtitle = "Male share of housework not explictly included in the model")
{% endhighlight %}

Next I fit some models with male share of unpaid domestic work as explanatory variables. First just as a linear relationship, and secondly as also an interaction with GDP per capita


{% highlight R lineanchors %}
model1 <- lmer(ltfr ~ gii + log(gdprppppc) + prop_male + (1 | country_fac), 
               data = model_ready)

model2 <- lmer(ltfr ~ gii + log(gdprppppc) * prop_male + (1 | country_fac), 
               data = model_ready)
{% endhighlight %}

Can we compare these models via AIC or a likelihood ratio test based on the extra degrees of freedom the `prop_male` variable uses up? I think so. We have the same error structure. It should at least approximately work. We get these results anyway, which seem to suggest that `model2` - the one with the interaction effect of male share of domestic work and income - is better than our null model, on all three criteria of lower AIC, lower BIC and a statistically significant likelihood test:

```
> anova(model0, model1, model2)
refitting model(s) with ML (instead of REML)
Data: model_ready
Models:
model0: ltfr ~ gii + log(gdprppppc) + (1 | country_fac)
model1: ltfr ~ gii + log(gdprppppc) + prop_male + (1 | country_fac)
model2: ltfr ~ gii + log(gdprppppc) * prop_male + (1 | country_fac)
       npar     AIC     BIC logLik -2*log(L)   Chisq Df Pr(>Chisq)    
model0    5 -138.92 -123.19 74.462   -148.92                          
model1    6 -136.94 -118.05 74.468   -148.94  0.0124  1     0.9114    
model2    7 -151.37 -129.34 82.687   -165.37 16.4376  1  5.028e-05 ***
```

Hmm ok. I'm not entirely convinced, but clearly there's something going on here.

Interactions are awkward. How do visualise the results? I had two goes at this, one home made:
<object type="image/svg+xml" data='/img/0290-home-made-preds.svg' width='100%'><img src='/img/0290-home-made-preds.png' width='100%'></object>

...and, much easier, way using the superb `marginaleffects` package of Vincent Arel-Bundock, Noah Greifer and Andrew Heiss:
<object type="image/svg+xml" data='/img/0290-margeff-preds.svg' width='100%'><img src='/img/0290-margeff-preds.png' width='100%'></object>

Both of these try to illustrate the (more complex) interaction by picking just three values of purchasing power parity GDP per capita, one value of gender inequality, and showing the predicted total fertility rate for different levels of male unpaid domestic work. This is pretty imperfect; the big problem being that gender inequality is highly correlated with these other variables so the visually presented case of constant GII doesn't really make sense (there simply aren't any countries with average GII, low income, and high male share of unpaid domestic work).

{% highlight R lineanchors %}
# Manual way of building a plot. Not even using predict()
b <- fixef(model2)

#' Predict TFR given those coefficients
calc_tfr <- function(prop_male, gdp, gii = mean(model_ready$gii)){
  exp(b[1] + 
      b[2] * gii + 
      b[3] * log(gdp) + 
      b[4] * prop_male + 
      b[5] * prop_male * log(gdp))
}


# Home-made prediction plot to show the interaction effect:
tibble(prop_male = rep(seq(from = 0.05, to = 0.45, length.out = 50), 3),
       gdp = rep(c(3000, 10000, 80000), each = 50)) |> 
  mutate(tfr = c(calc_tfr(prop_male, gdp)),
         gdp = dollar(gdp),
         gdp = fct_relevel(gdp, "$3,000")) |> 
  ggplot(aes(x = prop_male, colour = gdp, y = tfr)) +
  geom_line(linewidth = 1.5) +
  geom_point(data = model_ready, colour = "black") +
  scale_x_continuous(label = percent) +
  labs(x = "Proportion of adult housework done by men",
       y = "Predicted total fertility rate",
       colour = "PPP GDP per capita")

# marginaleffects package effort (much easier, including with 
# confidence intervals):
plot_predictions(model2, points = 1, condition = list(
  "prop_male",
  "gdprppppc" = c(3000, 10000, 80000))) +
  scale_y_continuous(trans = transform_exp(),
                     breaks = log(c(2, 4, 6)),
                     label = comma,
                     sec.axis = sec_axis(exp, name = "Total Fertility Rate")) +
  scale_x_continuous(label = percent) +
  labs(y = "log(total fertility rate)",
       colour = "PPP GDP per capita",
       fill = "PPP GDP per capita",
       x = "Proportion of adult housework done by men")
{% endhighlight %}



### `mgcv::gamm` and `mgcv::gam` - generalized additive mixed effects models

<object type="image/svg+xml" data='/img/0290-gam.svg' width='100%'><img src='/img/0290-gam.png' width='100%'></object>

<object type="image/svg+xml" data='/img/0290-gamm.svg' width='100%'><img src='/img/0290-gamm.png' width='100%'></object>









{% highlight R lineanchors %}


{% endhighlight %}




{% highlight R lineanchors %}


{% endhighlight %}



{% highlight R lineanchors %}


{% endhighlight %}



